# üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î. –§—É–Ω–∫—Ü–∏—è `aggregate_energy_data(dst)` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Excel —Ñ–∞–π–ª–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –µ—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `aggregate_from_db_json`.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω fallback –≤ `main.py`:

```python
aggregation_data = aggregate_energy_data(dst)

# –ï—Å–ª–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏–∑ —Ñ–∞–π–ª–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø—Ä–æ–±—É–µ–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ë–î)
if not aggregation_data and parsing_result and parsing_result.get("parsed"):
    logger.info(f"‚ö†Ô∏è [DIAG] –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏–∑ —Ñ–∞–π–ª–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø—Ä–æ–±—É—é –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
    raw_json_for_aggregation = {
        "batch_id": batch_id,
        "filename": safe_filename,
        "file_type": file_type_label.lower(),
        "parsing": parsing_result_data
    }
    aggregation_data = aggregate_from_db_json(raw_json_for_aggregation)
```

## üîç –ß—Ç–æ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç

1. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏–∑ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –ï—Å–ª–∏ `aggregate_energy_data(dst)` –≤–µ—Ä–Ω—É–ª `None`
   - –ò —Ñ–∞–π–ª –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `parsing_result`

2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:**
   - Excel —Ñ–∞–π–ª—ã ‚Üí `aggregate_energy_data(dst)`
   - –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí `aggregate_from_db_json(raw_json)`

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏–∑ –º–µ—Å—è—á–Ω—ã—Ö
- ‚úÖ –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–µ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è `[DIAG]`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 100%
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON —Ñ–∞–π–ª—ã –≤ `AGGREGATED_DIR`

