# ‚ö° –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ PDF –∏ OCR

## ‚úÖ –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç!

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: `http://localhost:8001/health` ‚Üí `{"service": "ingest", "status": "ok"}`

## üöÄ –í–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:8001/web/upload**

2. –í—ã–±–µ—Ä–∏—Ç–µ PDF —Ñ–∞–π–ª (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç)

3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"

4. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 2-5 –º–∏–Ω—É—Ç)

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   - ‚úÖ –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–µ–∫—Ü–∏—è "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è"
   - ‚úÖ –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "üîç OCR: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ"
   - ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ requests (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install requests

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python test_pdf_ocr.py "infra/data/inbox/2458dc3a-91e8-4e5b-863b-2fbde7693267__TTZ 133AA faktura.pdf"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (7+ –ú–ë) –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 3-5 –º–∏–Ω—É—Ç. –¢–∞–π–º–∞—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 5 –º–∏–Ω—É—Ç.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ curl (–¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤)

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞
curl -X POST http://localhost:8001/web/upload \
  -F "file=@infra/passport_demo1.pdf" \
  -o response.json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ batch_id –∏–∑ response.json
BATCH_ID=$(cat response.json | grep -o '"batch_id":"[^"]*"' | cut -d'"' -f4)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
curl http://localhost:8001/ingest/parse/$BATCH_ID | python -m json.tool
```

## üìä –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

### ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è
- –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (.pdf)
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–æ 50 –ú–ë)
- MIME-—Ç–∏–ø

### ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ PDF
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ pdfplumber
- –ü–æ–¥—Å—á–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å)

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π OCR
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (< 50 —Å–∏–º–≤–æ–ª–æ–≤/—Å—Ç—Ä–∞–Ω–∏—Ü—É)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (300 DPI)
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Tesseract (—Ä—É—Å—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (parsing_results dict)
- API endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:

```bash
# Windows PowerShell
docker compose -f infra/docker-compose.yml logs -f ingest

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker Desktop
# –û—Ç–∫—Ä–æ–π—Ç–µ Docker Desktop ‚Üí Containers ‚Üí eaip-ingest ‚Üí Logs
```

–û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ OCR:
```
INFO: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –º–∞–ª–æ —Ç–µ–∫—Å—Ç–∞ (X —Å–∏–º–≤–æ–ª–æ–≤/—Å—Ç—Ä–∞–Ω–∏—Ü—É), –ø—Ä–∏–º–µ–Ω—è—é OCR...
INFO: –ù–∞—á–∏–Ω–∞—é OCR –æ–±—Ä–∞–±–æ—Ç–∫—É PDF: /data/inbox/...
INFO: PDF –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ N –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
INFO: OCR —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –∏–∑–≤–ª–µ—á–µ–Ω–æ X —Å–∏–º–≤–æ–ª–æ–≤
INFO: OCR –∑–∞–≤–µ—Ä—à–µ–Ω: –≤—Å–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ X —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ N —Å—Ç—Ä–∞–Ω–∏—Ü
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (7+ –ú–ë):** –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 3-5 –º–∏–Ω—É—Ç
2. **–¢–∞–π–º–∞—É—Ç:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 5 –º–∏–Ω—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Ç–µ—Ä—è—é—Ç—Å—è)

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ PDF:

```json
{
  "batch_id": "uuid-here",
  "filename": "document.pdf",
  "status": "success",
  "parsing": {
    "file_type": "pdf",
    "parsed": true,
    "data": {
      "metadata": {
        "num_pages": 5
      },
      "total_characters": 1234,
      "ocr_used": true,
      "text": "–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç..."
    }
  }
}
```

–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:
- ‚úÖ –°–µ–∫—Ü–∏—è "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è" –≤–∏–¥–Ω–∞
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ü–∏—è "üîç OCR: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ"
- ‚úÖ –ü—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–æ

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ:
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Redis/PostgreSQL –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
4. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (JPG, PNG) —á–µ—Ä–µ–∑ OCR

