# ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª –∑–∞–≤–µ—Ä—à–µ–Ω–æ - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

**–î–∞—Ç–∞:** 2025-11-16  
**–°—Ç–∞—Ç—É—Å:** –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

## üìä –ß–∞—Å—Ç—å 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ #1

**–Ø—á–µ–π–∫–∞:** AF13  
**–õ–∏—Å—Ç:** –ë–∞–ª–∞–Ω—Å  
**–ü—Ä–æ–±–ª–µ–º–∞:** `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2 '!#REF!`  
**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:** `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2'!AM14`  
**–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è  
**–ú–µ—Ç–æ–¥:** –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —è—á–µ–µ–∫

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (—à–∞–≥–∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–≤–æ–¥–∞):**

1. **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–∞:** –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å–æ—Å–µ–¥–Ω–∏–µ —è—á–µ–π–∫–∏ –≤ —Ç–æ–º –∂–µ —Å—Ç–æ–ª–±—Ü–µ AF:
   - AF10 —Å–æ–¥–µ—Ä–∂–∏—Ç: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2 '!AM11`
   - AF11 —Å–æ–¥–µ—Ä–∂–∏—Ç: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2 '!AM12`
   - AF12 —Å–æ–¥–µ—Ä–∂–∏—Ç: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2 '!AM13`
   - AF14 —Å–æ–¥–µ—Ä–∂–∏—Ç: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2 '!AM15`

2. **–í—ã–≤–æ–¥ –ø–∞—Ç—Ç–µ—Ä–Ω–∞:** –ö–∞–∂–¥–∞—è —è—á–µ–π–∫–∞ AF —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —è—á–µ–π–∫—É AM –≤ –ª–∏—Å—Ç–µ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2" —Å —Ç–µ–º –∂–µ –Ω–æ–º–µ—Ä–æ–º —Å—Ç—Ä–æ–∫–∏.

3. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞:** 
   - AF13 –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–µ 13
   - –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –¥–æ–ª–∂–Ω–∞ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ AM14 (—Å—Ç—Ä–æ–∫–∞ 13 + 1 –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω—É)
   - –§–æ—Ä–º—É–ª–∞: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2'!AM14`

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –Ø—á–µ–π–∫–∞ AM14 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ª–∏—Å—Ç–µ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2" (–∑–Ω–∞—á–µ–Ω–∏–µ: 0)

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:**
- –°—Ç—Ä–æ–∫–∞ 13 –≤ –ª–∏—Å—Ç–µ "–ë–∞–ª–∞–Ω—Å" ‚Üí –°—Ç—Ä–æ–∫–∞ 14 –≤ –ª–∏—Å—Ç–µ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2"
- –°—Ç–æ–ª–±–µ—Ü AF ‚Üí –°—Ç–æ–ª–±–µ—Ü AM (–ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ —Å–æ—Å–µ–¥–Ω–∏—Ö —è—á–µ–µ–∫)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: `AM14`

## üìã –ß–∞—Å—Ç—å 2: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω (–¥–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `formula_templates.json` —Å 10 —Ç–∏–ø–∞–º–∏ —Ñ–æ—Ä–º—É–ª:

1. **—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥** - –≠–Ω–µ—Ä–≥–∏—è / –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
2. **–±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ** - SUM(–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
3. **—ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –í—ã—Ö–æ–¥ / –í—Ö–æ–¥
4. **—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–Ω–æ—Ä–º–∞—Ç–∏–≤—É** - IF(–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å <= –Ω–æ—Ä–º–∞—Ç–∏–≤, ...)
5. **–ø–æ—Ç–µ—Ä–∏** - –í—Ö–æ–¥ - –í—ã—Ö–æ–¥
6. **–∫–ø–¥** - (–í—ã—Ö–æ–¥ / –í—Ö–æ–¥) * 100
7. **–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ_–∏—Ç–æ–≥–∏** - SUM(–º–µ—Å—è—Ü—ã)
8. **–≥–æ–¥–æ–≤—ã–µ_–∏—Ç–æ–≥–∏** - SUM(–∫–≤–∞—Ä—Ç–∞–ª—ã)
9. **—Ç–µ–º–ø_—Ä–æ—Å—Ç–∞** - ((–¢–µ–∫—É—â–∏–π - –ü—Ä–µ–¥—ã–¥—É—â–∏–π) / –ü—Ä–µ–¥—ã–¥—É—â–∏–π) * 100
10. **cross_sheet_reference** - –°—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–π –ª–∏—Å—Ç

### –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –æ—Ç—Ä–∞—Å–ª–µ–π

**–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: —É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥, —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ: —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ_–ø–æ—Ç–µ—Ä–∏, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è_–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: —É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥, –±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–Ω–æ—Ä–º–∞—Ç–∏–≤—É
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ: –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ_–ø–æ—Ç–µ—Ä–∏, —É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥_–ø–æ_–≤–∏–¥–∞–º_–ø—Ä–æ–¥—É–∫—Ü–∏–∏

### –ú–∞–ø–ø–∏–Ω–≥–∏ –ª–∏—Å—Ç–æ–≤

**–ë–∞–ª–∞–Ω—Å:**
- –ü–∞—Ç—Ç–µ—Ä–Ω —Å—Å—ã–ª–æ–∫: AF{row} ‚Üí AM{row+1} –≤ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2"
- –§–æ—Ä–º—É–ª–∞ –∏—Ç–æ–≥–∞: =SUM(–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

**–î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä:**
- –£–¥–µ–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥: =–≠–Ω–µ—Ä–≥–∏—è / –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
- –¢–µ–º–ø —Ä–æ—Å—Ç–∞: =((–¢–µ–∫—É—â–∏–π - –ü—Ä–µ–¥—ã–¥—É—â–∏–π) / –ü—Ä–µ–¥—ã–¥—É—â–∏–π) * 100

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –ú–æ–¥—É–ª—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª
**–§–∞–π–ª:** `services/ingest/utils/ai_formula_restorer.py`

**–§—É–Ω–∫—Ü–∏–∏:**
- `restore_formulas_in_file()` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ—Ä–º—É–ª
- `restore_ref_error()` - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏ #REF!
- `_restore_by_pattern()` - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É —Å–æ—Å–µ–¥–Ω–∏—Ö —è—á–µ–µ–∫
- `_restore_with_ai()` - –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ò–ò-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω
**–§–∞–π–ª:** `formula_templates.json`

–°–æ–¥–µ—Ä–∂–∏—Ç:
- –®–∞–±–ª–æ–Ω—ã —Ñ–æ—Ä–º—É–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
- –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ú–∞–ø–ø–∏–Ω–≥–∏ –ª–∏—Å—Ç–æ–≤
- –ü—Ä–∏–º–µ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `formula_analysis_step1_result.json` - –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑
2. `formula_analysis_step2_result.json` - –ü–æ–∏—Å–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª
3. `formula_analysis_step3_result.json` - –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏
4. `formula_restoration_af13.json` - –î–µ—Ç–∞–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
5. `formula_restoration_report.json` - –û—Ç—á–µ—Ç
6. `formula_templates.json` - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω
7. `services/ingest/utils/ai_formula_restorer.py` - –ú–æ–¥—É–ª—å
8. `–≠–ù–ï–†–ì–û_–ü–ê–°–ü–û–†–¢_23102025_restored.xlsm` - –§–∞–π–ª —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º—É–ª–æ–π
9. `–≠–ù–ï–†–ì–û_–ü–ê–°–ü–û–†–¢_23102025_auto_restored.xlsm` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω —Å –º–æ–¥—É–ª–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –ò–ò-–ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã (126 –Ω–∞–π–¥–µ–Ω–æ)
4. –°–æ–∑–¥–∞—Ç—å API –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è –∏–∑ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã

## ‚úÖ –ò—Ç–æ–≥

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ AF13
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ä–∞–±–æ—á–∏–π –º–æ–¥—É–ª—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω —Ñ–æ—Ä–º—É–ª
- ‚úÖ –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π!**

