# üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö EAIP

## –û–±–∑–æ—Ä

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã EAIP.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### 1. Ingest Service

#### `ingest_batches`
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| batch_id | VARCHAR(255) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞—Ç—á–∞ |
| filename | VARCHAR(500) | –ò–º—è —Ñ–∞–π–ª–∞ |
| file_type | VARCHAR(50) | –¢–∏–ø —Ñ–∞–π–ª–∞ (pdf, xlsx, docx, image) |
| file_size | BIGINT | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö |
| file_path | TEXT | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É |
| status | VARCHAR(50) | –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| ai_used | BOOLEAN | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ª–∏ –ò–ò |
| ai_provider | VARCHAR(50) | –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ò–ò (deepseek, openai) |
| ocr_used | BOOLEAN | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ª–∏ OCR |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

#### `ingest_parsing_results`
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| batch_id | VARCHAR(255) | –°—Å—ã–ª–∫–∞ –Ω–∞ ingest_batches |
| parsed | BOOLEAN | –£—Å–ø–µ—à–Ω–æ –ª–∏ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω |
| total_characters | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ |
| total_pages | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü |
| total_tables | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü |
| extracted_text | TEXT | –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç |
| structured_data | JSONB | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| metadata | JSONB | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞ |
| error_message | TEXT | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### 2. Validate Service

#### `validate_results`
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| batch_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞—Ç—á–∞ |
| passed | BOOLEAN | –ü—Ä–æ—à–ª–∞ –ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è |
| issues | JSONB | –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º |
| validation_rules | JSONB | –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |
| validated_at | TIMESTAMP | –î–∞—Ç–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |

### 3. Analytics Service

#### `analytics_forecasts`
–ü—Ä–æ–≥–Ω–æ–∑—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| batch_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞—Ç—á–∞ |
| meter_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—á–µ—Ç—á–∏–∫–∞ |
| forecast_data | JSONB | –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–∞ |
| horizon | INTEGER | –ì–æ—Ä–∏–∑–æ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

#### `analytics_data_points`
–¢–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| batch_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞—Ç—á–∞ |
| meter_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—á–µ—Ç—á–∏–∫–∞ |
| timestamp | TIMESTAMP | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ |
| value | DOUBLE PRECISION | –ó–Ω–∞—á–µ–Ω–∏–µ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

### 4. Gateway-Auth Service

#### `users`
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| username | VARCHAR(255) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ) |
| email | VARCHAR(255) | Email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| password_hash | VARCHAR(255) | –•–µ—à –ø–∞—Ä–æ–ª—è |
| is_active | BOOLEAN | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| is_admin | BOOLEAN | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

#### `user_sessions`
–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| user_id | UUID | –°—Å—ã–ª–∫–∞ –Ω–∞ users |
| token | VARCHAR(500) | –¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| expires_at | TIMESTAMP | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

### 5. Reports Service

#### `reports`
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| audit_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—É–¥–∏—Ç–∞ |
| report_type | VARCHAR(100) | –¢–∏–ø –æ—Ç—á–µ—Ç–∞ |
| file_path | TEXT | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –æ—Ç—á–µ—Ç–∞ |
| file_size | BIGINT | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ |
| status | VARCHAR(50) | –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| metadata | JSONB | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| completed_at | TIMESTAMP | –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |

### 6. Management Service

#### `audit_records`
–ó–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| audit_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—É–¥–∏—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| batch_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞—Ç—á–∞ |
| status | VARCHAR(50) | –°—Ç–∞—Ç—É—Å –∞—É–¥–∏—Ç–∞ |
| data | JSONB | –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–∞ |
| created_by | UUID | –°—Å—ã–ª–∫–∞ –Ω–∞ users |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | TIMESTAMP | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### 7. Recommend Service

#### `recommendations`
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| audit_id | VARCHAR(255) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—É–¥–∏—Ç–∞ |
| recommendation_type | VARCHAR(100) | –¢–∏–ø —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
| priority | VARCHAR(50) | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (low, medium, high) |
| content | TEXT | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
| data | JSONB | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

### 8. System

#### `system_logs`
–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| service_name | VARCHAR(100) | –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ |
| level | VARCHAR(20) | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∞ (INFO, ERROR, WARNING) |
| message | TEXT | –°–æ–æ–±—â–µ–Ω–∏–µ |
| metadata | JSONB | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

## –ò–Ω–¥–µ–∫—Å—ã

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –∏–Ω–¥–µ–∫—Å—ã –Ω–∞:
- –ü–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è (batch_id, audit_id, status, created_at)

## –¢—Ä–∏–≥–≥–µ—Ä—ã

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at` –¥–ª—è —Ç–∞–±–ª–∏—Ü:
- `ingest_batches`
- `ingest_parsing_results`
- `users`
- `audit_records`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
docker compose exec postgres psql -U eaip_user -d eaip_db

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker compose -f docker-compose.staging.yml exec postgres psql -U eaip_user -d eaip_db
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü

```bash
# –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
\dt

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
\d ingest_batches

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) FROM ingest_batches;
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
docker compose exec postgres pg_dump -U eaip_user eaip_db > backup_$(date +%Y%m%d).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker compose exec -T postgres psql -U eaip_user eaip_db < backup_20250101.sql
```

