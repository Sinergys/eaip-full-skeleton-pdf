# üîß –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª –≤ —ç–Ω–µ—Ä–≥–æ–ø–∞—Å–ø–æ—Ä—Ç–µ —Å –ø–æ–º–æ—â—å—é –ò–ò

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–§–∞–π–ª:** `–≠–ù–ï–†–ì–û_–ü–ê–°–ü–û–†–¢_23102025.xlsm`  
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `C:\Users\DELL\Downloads\Telegram Desktop\`

**–õ–∏—Å—Ç—ã –≤ —Ñ–∞–π–ª–µ:**
- Sheet1
- –£–∑–µ–ª —É—á–µ—Ç–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2 
- –ë–∞–ª–∞–Ω—Å
- –î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä
- –º–∞–∑—É—Ç,—É–≥–æ–ª—å 5
- –†–∞—Å—Ö–æ–¥ –Ω–∞ –µ–¥.–ø
- –ø–∞—Å–ø–æ—Ä—Ç –∑–¥–∞–Ω–∏–µ
- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
- –õ–∏—Å—Ç1

## üéØ –ó–∞–¥–∞—á–∞

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ–æ—Ä–º—É–ª—ã –≤ —ç–Ω–µ—Ä–≥–æ–ø–∞—Å–ø–æ—Ä—Ç–µ –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º —Å –ø–æ–º–æ—â—å—é –ò–ò –∏ —Å–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π.

## üìã –ß–∞—Å—Ç—å 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

### –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞

–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π –ª–∏—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
- –Ø—á–µ–µ–∫ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–æ—Ä–º—É–ª–∞–º–∏
- –Ø—á–µ–µ–∫ —Å –æ—à–∏–±–∫–∞–º–∏ (#REF!, #VALUE!, #N/A)
- –Ø—á–µ–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏ –¥–æ–ª–∂–Ω—ã —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ –ª–∏—Å—Ç—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤

### –®–∞–≥ 2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã —Ñ–æ—Ä–º—É–ª –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**

1. **–£–¥–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**
   - –£–¥–µ–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ = –û–±—â–∏–π —Ä–∞—Å—Ö–æ–¥ / –û–±—ä–µ–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏
   - –§–æ—Ä–º—É–ª–∞: `=–≠–Ω–µ—Ä–≥–∏—è / –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ`
   - –ï–¥–∏–Ω–∏—Ü—ã: –∫–í—Ç¬∑—á/–∫–≥, –º¬≥/–∫–≥, –∏ —Ç.–¥.

2. **–ë–∞–ª–∞–Ω—Å—ã —ç–Ω–µ—Ä–≥–∏–∏**
   - –ò—Ç–æ–≥–æ = –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ + –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω—É–∂–¥—ã + –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ + –•–æ–∑-–±—ã—Ç–æ–≤—ã–µ
   - –§–æ—Ä–º—É–ª–∞: `=SUM(–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ:–•–æ–∑-–±—ã—Ç–æ–≤—ã–µ)`
   - –ï–¥–∏–Ω–∏—Ü—ã: –∫–í—Ç¬∑—á, –º¬≥

3. **–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
   - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = –ü–æ–ª–µ–∑–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è / –ó–∞—Ç—Ä–∞—á–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è
   - –§–æ—Ä–º—É–ª–∞: `=–í—ã—Ö–æ–¥ / –í—Ö–æ–¥`
   - –ï–¥–∏–Ω–∏—Ü—ã: –±–µ–∑—Ä–∞–∑–º–µ—Ä–Ω—ã–π (0-1)

4. **–°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º–∏**
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ = IF(–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å <= –ù–æ—Ä–º–∞—Ç–∏–≤, "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", "–ü—Ä–µ–≤—ã—à–∞–µ—Ç")
   - –§–æ—Ä–º—É–ª–∞: `=IF(–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å <= –ù–æ—Ä–º–∞—Ç–∏–≤, "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", "–ü—Ä–µ–≤—ã—à–∞–µ—Ç")`

5. **–ü–æ—Ç–µ—Ä–∏ –∏ –ö–ü–î**
   - –ü–æ—Ç–µ—Ä–∏ = –í—Ö–æ–¥ - –í—ã—Ö–æ–¥
   - –ö–ü–î = (–í—ã—Ö–æ–¥ / –í—Ö–æ–¥) * 100
   - –§–æ—Ä–º—É–ª–∞: `=(–í—ã—Ö–æ–¥ / –í—Ö–æ–¥) * 100`
   - –ï–¥–∏–Ω–∏—Ü—ã: %

6. **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   - –ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏ = –°—É–º–º–∞ –º–µ—Å—è—Ü–µ–≤ –∫–≤–∞—Ä—Ç–∞–ª–∞
   - –ì–æ–¥–æ–≤—ã–µ –∏—Ç–æ–≥–∏ = –°—É–º–º–∞ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ –≥–æ–¥–∞
   - –§–æ—Ä–º—É–ª–∞: `=SUM(–ö–≤–∞—Ä—Ç–∞–ª1:–ö–≤–∞—Ä—Ç–∞–ª4)`

### –®–∞–≥ 3: –ü—Ä–∏–º–µ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª

**–î–ª—è –ª–∏—Å—Ç–∞ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2":**

1. **–ò—Ç–æ–≥–æ –ø–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—é (—Å—Ç—Ä–æ–∫–∏ 11-14)**
   - –î–æ–ª–∂–Ω–æ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –ª–∏—Å—Ç "–ë–∞–ª–∞–Ω—Å"
   - –§–æ—Ä–º—É–ª–∞: `='–ë–∞–ª–∞–Ω—Å'!C10` (–¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏)
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ò—Ç–æ–≥–∏ –ø–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—é –±–µ—Ä—É—Ç—Å—è –∏–∑ –±–∞–ª–∞–Ω—Å–∞

2. **–£–¥–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**
   - –Ø—á–µ–π–∫–∞: "–†–∞—Å—Ö–æ–¥ –Ω–∞ –µ–¥.–ø"!C5
   - –§–æ—Ä–º—É–ª–∞: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2'!C11 / '–î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä'!C15`
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –£–¥–µ–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ = –≠–Ω–µ—Ä–≥–∏—è / –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ

**–î–ª—è –ª–∏—Å—Ç–∞ "–ë–∞–ª–∞–Ω—Å":**

1. **–ò—Ç–æ–≥–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (—Å—Ç—Ä–æ–∫–∏ 10-13)**
   - –§–æ—Ä–º—É–ª–∞: `=SUM(C10:C13)`
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ò—Ç–æ–≥–æ = –°—É–º–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º**
   - –§–æ—Ä–º—É–ª–∞: `='–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2'!C11` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –î–∞–Ω–Ω—ã–µ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º –±–µ—Ä—É—Ç—Å—è –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–î–ª—è –ª–∏—Å—Ç–∞ "–î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä":**

1. **–£–¥–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**
   - –§–æ—Ä–º—É–ª–∞: `=C11 / C15` (–≠–Ω–µ—Ä–≥–∏—è / –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ)
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –†–∞—Å—á–µ—Ç —É–¥–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞

2. **–¢–µ–º–ø —Ä–æ—Å—Ç–∞**
   - –§–æ—Ä–º—É–ª–∞: `=((C11 - B11) / B11) * 100`
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –¢–µ–º–ø —Ä–æ—Å—Ç–∞ = ((–¢–µ–∫—É—â–∏–π - –ü—Ä–µ–¥—ã–¥—É—â–∏–π) / –ü—Ä–µ–¥—ã–¥—É—â–∏–π) * 100

## üìã –ß–∞—Å—Ç—å 2: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω —Ñ–æ—Ä–º—É–ª

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞

```json
{
  "formula_templates": {
    "—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥": {
      "pattern": "{–æ–±—â–∏–π_—Ä–∞—Å—Ö–æ–¥} / {–æ–±—ä–µ–º_–ø—Ä–æ–¥—É–∫—Ü–∏–∏}",
      "description": "–£–¥–µ–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É –ø—Ä–æ–¥—É–∫—Ü–∏–∏",
      "required_fields": ["–æ–±—â–∏–π_—Ä–∞—Å—Ö–æ–¥", "–æ–±—ä–µ–º_–ø—Ä–æ–¥—É–∫—Ü–∏–∏"],
      "unit": "–∫–í—Ç¬∑—á/–µ–¥",
      "applicable_to": ["–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å", "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"],
      "logic": "–†–∞—Å—á–µ—Ç —É–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –º–µ—Ç–æ–¥–∏–∫–µ",
      "formula_excel": "={energy_cell} / {production_cell}",
      "validation": {
        "min_value": 0,
        "max_value": 1000,
        "check_zero_division": true
      }
    },
    "–±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ": {
      "pattern": "SUM({category1}:{category4})",
      "description": "–ò—Ç–æ–≥–æ –ø–æ –±–∞–ª–∞–Ω—Å—É —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è",
      "required_fields": ["—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ", "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ_–Ω—É–∂–¥—ã", "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ", "—Ö–æ–∑_–±—ã—Ç–æ–≤—ã–µ"],
      "unit": "–∫–í—Ç¬∑—á",
      "applicable_to": ["electricity", "gas", "water"],
      "logic": "–ò—Ç–æ–≥–æ = –°—É–º–º–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è",
      "formula_excel": "=SUM({tech_cell}:{household_cell})",
      "validation": {
        "must_be_positive": true,
        "should_match_total": "total_consumption_cell"
      }
    },
    "—ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å": {
      "pattern": "{–ø–æ–ª–µ–∑–Ω–∞—è_—ç–Ω–µ—Ä–≥–∏—è} / {–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–∞—è_—ç–Ω–µ—Ä–≥–∏—è}",
      "description": "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
      "required_fields": ["–ø–æ–ª–µ–∑–Ω–∞—è_—ç–Ω–µ—Ä–≥–∏—è", "–∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–∞—è_—ç–Ω–µ—Ä–≥–∏—è"],
      "unit": "–±–µ–∑—Ä–∞–∑–º–µ—Ä–Ω—ã–π (0-1)",
      "applicable_to": ["equipment", "processes"],
      "logic": "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å = –í—ã—Ö–æ–¥ / –í—Ö–æ–¥",
      "formula_excel": "={output_cell} / {input_cell}",
      "validation": {
        "min_value": 0,
        "max_value": 1,
        "check_zero_division": true
      }
    },
    "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–Ω–æ—Ä–º–∞—Ç–∏–≤—É": {
      "pattern": "IF({–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å} <= {–Ω–æ—Ä–º–∞—Ç–∏–≤}, \"–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç\", \"–ü—Ä–µ–≤—ã—à–∞–µ—Ç\")",
      "description": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–æ—Ä–º–∞—Ç–∏–≤—É",
      "required_fields": ["–ø–æ–∫–∞–∑–∞—Ç–µ–ª—å", "–Ω–æ—Ä–º–∞—Ç–∏–≤"],
      "unit": "—Ç–µ–∫—Å—Ç",
      "applicable_to": ["all_resources"],
      "logic": "–ï—Å–ª–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å <= –Ω–æ—Ä–º–∞—Ç–∏–≤, —Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –∏–Ω–∞—á–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç",
      "formula_excel": "=IF({indicator_cell} <= {normative_cell}, \"–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç\", \"–ü—Ä–µ–≤—ã—à–∞–µ—Ç\")",
      "validation": {
        "allowed_values": ["–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç", "–ü—Ä–µ–≤—ã—à–∞–µ—Ç"]
      }
    },
    "–ø–æ—Ç–µ—Ä–∏": {
      "pattern": "{–≤—Ö–æ–¥} - {–≤—ã—Ö–æ–¥}",
      "description": "–†–∞—Å—á–µ—Ç –ø–æ—Ç–µ—Ä—å —ç–Ω–µ—Ä–≥–∏–∏",
      "required_fields": ["–≤—Ö–æ–¥", "–≤—ã—Ö–æ–¥"],
      "unit": "–∫–í—Ç¬∑—á",
      "applicable_to": ["electricity", "gas", "heat"],
      "logic": "–ü–æ—Ç–µ—Ä–∏ = –í—Ö–æ–¥ - –í—ã—Ö–æ–¥",
      "formula_excel": "={input_cell} - {output_cell}",
      "validation": {
        "must_be_positive": true,
        "max_percentage": 20
      }
    },
    "–∫–ø–¥": {
      "pattern": "({–≤—ã—Ö–æ–¥} / {–≤—Ö–æ–¥}) * 100",
      "description": "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ª–µ–∑–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è",
      "required_fields": ["–≤—Ö–æ–¥", "–≤—ã—Ö–æ–¥"],
      "unit": "%",
      "applicable_to": ["equipment", "transformers"],
      "logic": "–ö–ü–î = (–í—ã—Ö–æ–¥ / –í—Ö–æ–¥) * 100",
      "formula_excel": "=({output_cell} / {input_cell}) * 100",
      "validation": {
        "min_value": 0,
        "max_value": 100,
        "check_zero_division": true
      }
    },
    "–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ_–∏—Ç–æ–≥–∏": {
      "pattern": "SUM({–º–µ—Å—è—Ü1}:{–º–µ—Å—è—Ü3})",
      "description": "–ò—Ç–æ–≥–æ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª—É",
      "required_fields": ["–º–µ—Å—è—Ü1", "–º–µ—Å—è—Ü2", "–º–µ—Å—è—Ü3"],
      "unit": "–∫–í—Ç¬∑—á",
      "applicable_to": ["electricity", "gas", "water"],
      "logic": "–ö–≤–∞—Ä—Ç–∞–ª = –°—É–º–º–∞ –º–µ—Å—è—Ü–µ–≤ –∫–≤–∞—Ä—Ç–∞–ª–∞",
      "formula_excel": "=SUM({month1_cell}:{month3_cell})",
      "validation": {
        "must_be_positive": true,
        "should_match_quarter_total": "quarter_total_cell"
      }
    },
    "–≥–æ–¥–æ–≤—ã–µ_–∏—Ç–æ–≥–∏": {
      "pattern": "SUM({–∫–≤–∞—Ä—Ç–∞–ª1}:{–∫–≤–∞—Ä—Ç–∞–ª4})",
      "description": "–ò—Ç–æ–≥–æ –∑–∞ –≥–æ–¥",
      "required_fields": ["–∫–≤–∞—Ä—Ç–∞–ª1", "–∫–≤–∞—Ä—Ç–∞–ª2", "–∫–≤–∞—Ä—Ç–∞–ª3", "–∫–≤–∞—Ä—Ç–∞–ª4"],
      "unit": "–∫–í—Ç¬∑—á",
      "applicable_to": ["electricity", "gas", "water"],
      "logic": "–ì–æ–¥ = –°—É–º–º–∞ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ –≥–æ–¥–∞",
      "formula_excel": "=SUM({quarter1_cell}:{quarter4_cell})",
      "validation": {
        "must_be_positive": true,
        "should_match_year_total": "year_total_cell"
      }
    },
    "—Ç–µ–º–ø_—Ä–æ—Å—Ç–∞": {
      "pattern": "(({—Ç–µ–∫—É—â–∏–π} - {–ø—Ä–µ–¥—ã–¥—É—â–∏–π}) / {–ø—Ä–µ–¥—ã–¥—É—â–∏–π}) * 100",
      "description": "–¢–µ–º–ø —Ä–æ—Å—Ç–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è",
      "required_fields": ["—Ç–µ–∫—É—â–∏–π", "–ø—Ä–µ–¥—ã–¥—É—â–∏–π"],
      "unit": "%",
      "applicable_to": ["electricity", "gas", "water"],
      "logic": "–¢–µ–º–ø —Ä–æ—Å—Ç–∞ = ((–¢–µ–∫—É—â–∏–π - –ü—Ä–µ–¥—ã–¥—É—â–∏–π) / –ü—Ä–µ–¥—ã–¥—É—â–∏–π) * 100",
      "formula_excel": "=(({current_cell} - {previous_cell}) / {previous_cell}) * 100",
      "validation": {
        "check_zero_division": true,
        "allowed_range": [-100, 1000]
      }
    }
  },
  "business_rules": {
    "–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å": {
      "required_formulas": [
        "—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥",
        "—ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
        "–±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ"
      ],
      "industry_specific": [
        "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ_–ø–æ—Ç–µ—Ä–∏",
        "–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è_–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è"
      ]
    },
    "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ": {
      "required_formulas": [
        "—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥",
        "–±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ",
        "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–Ω–æ—Ä–º–∞—Ç–∏–≤—É"
      ],
      "industry_specific": [
        "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ_–ø–æ—Ç–µ—Ä–∏",
        "—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥_–ø–æ_–≤–∏–¥–∞–º_–ø—Ä–æ–¥—É–∫—Ü–∏–∏"
      ]
    }
  },
  "sheet_mappings": {
    "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2": {
      "total_consumption_cell": {
        "should_link_to": "–ë–∞–ª–∞–Ω—Å!C10",
        "formula_template": "–±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ",
        "description": "–ò—Ç–æ–≥–æ –ø–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—é"
      },
      "quarter_totals": {
        "formula_template": "–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ_–∏—Ç–æ–≥–∏",
        "description": "–ò—Ç–æ–≥–æ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª—É"
      }
    },
    "–ë–∞–ª–∞–Ω—Å": {
      "categories_total": {
        "formula_template": "–±–∞–ª–∞–Ω—Å_–∏—Ç–æ–≥–æ",
        "description": "–ò—Ç–æ–≥–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
      },
      "should_link_from": {
        "source_sheet": "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä 2",
        "description": "–î–∞–Ω–Ω—ã–µ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º"
      }
    },
    "–î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä": {
      "specific_consumption": {
        "formula_template": "—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥",
        "description": "–£–¥–µ–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥"
      },
      "growth_rate": {
        "formula_template": "—Ç–µ–º–ø_—Ä–æ—Å—Ç–∞",
        "description": "–¢–µ–º–ø —Ä–æ—Å—Ç–∞"
      }
    },
    "–†–∞—Å—Ö–æ–¥ –Ω–∞ –µ–¥.–ø": {
      "specific_consumption": {
        "formula_template": "—É–¥–µ–ª—å–Ω—ã–π_—Ä–∞—Å—Ö–æ–¥",
        "description": "–†–∞—Å—Ö–æ–¥ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É –ø—Ä–æ–¥—É–∫—Ü–∏–∏"
      },
      "compliance": {
        "formula_template": "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–Ω–æ—Ä–º–∞—Ç–∏–≤—É",
        "description": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤—É"
      }
    }
  }
}
```

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ú–æ–¥—É–ª—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª

**–§–∞–π–ª:** `services/ingest/utils/ai_formula_restorer.py`

```python
"""
–ú–æ–¥—É–ª—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª –≤ —ç–Ω–µ—Ä–≥–æ–ø–∞—Å–ø–æ—Ä—Ç–µ —Å –ø–æ–º–æ—â—å—é –ò–ò.
"""
import logging
from typing import Dict, Any, Optional, List, Tuple
from openpyxl import load_workbook
from openpyxl.worksheet.worksheet import Worksheet

logger = logging.getLogger(__name__)

class AIFormulaRestorer:
    """
    –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ñ–æ—Ä–º—É–ª –≤ —ç–Ω–µ—Ä–≥–æ–ø–∞—Å–ø–æ—Ä—Ç–µ —Å –ø–æ–º–æ—â—å—é –ò–ò.
    """
    
    def __init__(self):
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —à–∞–±–ª–æ–Ω —Ñ–æ—Ä–º—É–ª
        self.formula_templates = self._load_formula_templates()
    
    def restore_formulas_in_file(
        self,
        file_path: str,
        output_path: Optional[str] = None
    ) -> Dict[str, Any]:
        """
        –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –≤ —Ñ–∞–π–ª–µ —ç–Ω–µ—Ä–≥–æ–ø–∞—Å–ø–æ—Ä—Ç–∞.
        
        Args:
            file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —ç–Ω–µ—Ä–≥–æ–ø–∞—Å–ø–æ—Ä—Ç–∞
            output_path: –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–µ—Å–ª–∏ None, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π)
        
        Returns:
            –û—Ç—á–µ—Ç –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∞—Ö
        """
        workbook = load_workbook(file_path, data_only=False)
        
        restored = {}
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –ª–∏—Å—Ç
        for sheet_name in workbook.sheetnames:
            sheet = workbook[sheet_name]
            restored[sheet_name] = self._restore_formulas_in_sheet(sheet)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        output = output_path or file_path
        workbook.save(output)
        
        return {
            "file_path": file_path,
            "output_path": output,
            "restored_by_sheet": restored,
            "total_restored": sum(len(v) for v in restored.values())
        }
    
    def _restore_formulas_in_sheet(self, sheet: Worksheet) -> List[Dict[str, Any]]:
        """
        –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –Ω–∞ –ª–∏—Å—Ç–µ.
        
        Returns:
            –°–ø–∏—Å–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª
        """
        restored = []
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–∞
        # –ù–∞—Ö–æ–¥–∏–º —è—á–µ–π–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–æ—Ä–º—É–ª–∞–º–∏
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É–ª—ã
        
        return restored
    
    def _load_formula_templates(self) -> Dict[str, Any]:
        """
        –ó–∞–≥—Ä—É–∂–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã —Ñ–æ—Ä–º—É–ª –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
        """
        # TODO: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ JSON —Ñ–∞–π–ª–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
        return {}
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª**
   - `services/ingest/utils/ai_formula_restorer.py`
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å `ai_parser.py` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

2. **–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ñ–æ—Ä–º—É–ª**
   - `config/formula_templates.json`
   - –•—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω—ã —Ñ–æ—Ä–º—É–ª –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤

3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Å–ø–æ—Ä—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ñ–æ—Ä–º—É–ª—ã

4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
   - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤

