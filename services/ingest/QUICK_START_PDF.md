# Быстрый старт: Улучшенная обработка PDF

## Что изменилось

✅ **Предварительная классификация** - тип PDF определяется ДО парсинга  
✅ **OCR-first стратегия** - сканированные PDF обрабатываются эффективнее  
✅ **Извлечение таблиц из OCR** - таблицы находятся даже в сканированных документах  
✅ **Проверка Java** - Tabula не вызывает ошибки при отсутствии Java  

## Как это работает

### Автоматически

Система автоматически:
1. Классифицирует тип PDF (текст/изображение)
2. Выбирает оптимальную стратегию обработки
3. Извлекает таблицы из OCR текста (если применимо)
4. Структурирует данные

### Для сканированных PDF

```
PDF → Классификация (image_based) → OCR → Извлечение таблиц → Результат
```

### Для текстовых PDF

```
PDF → Классификация (text_based) → Парсинг → Извлечение таблиц → Результат
```

## Результаты

Результат обработки теперь включает:

```json
{
    "pdf_type": "image_based",
    "pdf_type_confidence": "high",
    "processing_strategy": "ocr_first",
    "text_ratio": 0.15,
    "tables": [
        {
            "page": 1,
            "method": "ocr_heuristic",
            "rows": [...],
            "row_count": 10,
            "col_count": 5
        }
    ],
    "structured_data": [...]
}
```

## Установка зависимостей

### Обязательные (уже установлены)
- PyPDF2, pdfplumber
- Tesseract OCR
- Poppler

### Опциональные (для улучшения)
- Java (для Tabula) - уже добавлена в Dockerfile
- scikit-image (для улучшения изображений) - уже в requirements.txt

## Проверка работы

1. Загрузите сканированный PDF через веб-интерфейс
2. Проверьте логи - должно быть:
   ```
   INFO - Классификация PDF: type=image_based, strategy=ocr_first
   INFO - PDF определен как image-based, применяю OCR-first стратегию
   INFO - Извлечено X таблиц из OCR текста
   ```
3. Проверьте результаты - должны быть таблицы даже в сканированных документах

## Устранение проблем

### Java не найдена
**Симптом:** В логах "Java не найдена. Tabula требует Java Runtime Environment."

**Решение:**
- Windows: `choco install openjdk`
- Linux: `sudo apt-get install default-jre`
- Docker: уже добавлено в Dockerfile

### OCR не извлекает таблицы
**Симптом:** Таблицы не найдены в сканированных PDF

**Причина:** Таблицы могут быть не распознаны эвристиками

**Решение:** Улучшить эвристики в `utils/ocr_table_extractor.py` или использовать обученные модели (P1)

### Классификация неверна
**Симптом:** PDF классифицирован неправильно

**Решение:** Проверить метрики в логах, при необходимости настроить пороги в `utils/pdf_classifier.py`

