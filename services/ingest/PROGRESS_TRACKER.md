# üìä –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (PDF, Excel, Word, Image) –∏ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **`utils/progress_tracker.py`** ‚Äî –º–æ–¥—É–ª—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - `ProgressTracker` ‚Äî –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
   - `FileType` ‚Äî enum —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
   - `ProcessingStage` ‚Äî enum —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –í–µ—Å–∞ —ç—Ç–∞–ø–æ–≤ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

2. **API Endpoint** ‚Äî `GET /api/progress/{batch_id}`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞

3. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** ‚Äî `web/upload.html`
   - –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
   - –°–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏ —Å—Ç–∞—Ç—É—Å–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 500–º—Å

## –≠—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –î–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤:
- **upload** ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (5%)
- **validation** ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è (2%)
- **parsing** ‚Äî –ü–∞—Ä—Å–∏–Ω–≥ (15-60% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞)
- **saving** ‚Äî –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (8-20%)
- **completed** ‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–æ (5-10%)

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —ç—Ç–∞–ø—ã:

**PDF:**
- **ocr** ‚Äî OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (50%) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —ç—Ç–∞–ø –¥–ª—è —Å–∫–∞–Ω–æ–≤

**Excel:**
- **specialized_parsing** ‚Äî –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (25%) ‚Äî –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —É–∑–ª—ã —É—á–µ—Ç–∞
- **aggregation** ‚Äî –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (15%)

**Word:**
- **parsing** ‚Äî –ü–∞—Ä—Å–∏–Ω–≥ (60%) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —ç—Ç–∞–ø

**Image:**
- **ocr** ‚Äî OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (60%) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —ç—Ç–∞–ø
- **ai_analysis** ‚Äî –ê–Ω–∞–ª–∏–∑ –ò–ò (10%, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –í–µ—Å–∞ —ç—Ç–∞–ø–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–æ–≤ —ç—Ç–∞–ø–æ–≤:

```python
STAGE_WEIGHTS = {
    FileType.PDF: {
        "upload": 5,
        "validation": 2,
        "parsing": 15,
        "ocr": 50,  # –û—Å–Ω–æ–≤–Ω–æ–π —ç—Ç–∞–ø –¥–ª—è PDF
        "aggregation": 5,
        "saving": 8,
        "completed": 5,
    },
    # ... –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∫–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤:

```python
from utils.progress_tracker import (
    FileType,
    ProcessingStage,
    create_progress_tracker,
    update_file_processing_progress,
)

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–∫–µ—Ä–∞
tracker = create_progress_tracker(batch_id, FileType.PDF)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —ç—Ç–∞–ø–∞
tracker.update_stage(
    ProcessingStage.OCR,
    progress=50,
    message="–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 5 –∏–∑ 10..."
)

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–∞–ø–∞
tracker.complete_stage(ProcessingStage.OCR, "OCR –∑–∞–≤–µ—Ä—à–µ–Ω")

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
tracker.complete()
```

### –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:

–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 500–º—Å —á–µ—Ä–µ–∑ –æ–ø—Ä–æ—Å API `/api/progress/{batch_id}`.

## –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

- **‚óã** ‚Äî –û–∂–∏–¥–∞–Ω–∏–µ (pending)
- **‚ü≥** ‚Äî –í –ø—Ä–æ—Ü–µ—Å—Å–µ (active)
- **‚úì** ‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–æ (completed)
- **‚úó** ‚Äî –û—à–∏–±–∫–∞ (error)

## –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ API

```json
{
  "batch_id": "abc-123",
  "file_type": "pdf",
  "overall_progress": 65,
  "current_stage": "ocr",
  "stages": {
    "upload": {
      "progress": 100,
      "message": "–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ",
      "started_at": "2024-11-15T10:00:00Z"
    },
    "ocr": {
      "progress": 60,
      "message": "–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 6 –∏–∑ 10...",
      "started_at": "2024-11-15T10:00:05Z"
    }
  },
  "is_completed": false,
  "has_error": false
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
2. **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –≤–µ—Å–∞ —ç—Ç–∞–ø–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
3. **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
4. **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 500–º—Å
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- WebSocket –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤–º–µ—Å—Ç–æ polling)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –ë–î –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (Celery)

