# –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ by_usage –ø–µ—Ä–µ–¥ fill_balans_sheet()

**–î–∞—Ç–∞:** 2025-01-XX  
**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `eaip_full_skeleton/services/ingest/main.py` (—Å—Ç—Ä–æ–∫–∏ 1959-1990)
- `eaip_full_skeleton/services/ingest/utils/readiness_validator.py` (—Å—Ç—Ä–æ–∫–∏ 317-329, 360-366)

---

## ‚úÖ –ß–¢–û –î–û–ë–ê–í–õ–ï–ù–û

### 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ fill_balans_sheet() –≤ main.py

**–ú–µ—Å—Ç–æ:** –ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `fill_balans_sheet()` (—Å—Ç—Ä–æ–∫–∞ 1959)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –ù–∞–ª–∏—á–∏–µ `by_usage` –≤ –∫–∞–∂–¥–æ–º –∫–≤–∞—Ä—Ç–∞–ª–µ `resources_data["electricity"]`
- –ü–æ–¥—Å—á–µ—Ç –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ —Å `by_usage` –∏ –±–µ–∑ –Ω–µ–≥–æ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –µ—Å–ª–∏ `by_usage` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–õ–æ–≥–∏:**
```
INFO: –ü–µ—Ä–µ–¥ fill_balans_sheet(): –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ —Å by_usage: X, –±–µ–∑: Y
WARNING: –ö–≤–∞—Ä—Ç–∞–ª—ã –±–µ–∑ by_usage (–±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã –≤ –ª–∏—Å—Ç–µ –±–∞–ª–∞–Ω—Å–∞): [...]
WARNING: –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:
  1. –§–∞–π–ª pererashod.xlsx –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
  2. –§—É–Ω–∫—Ü–∏—è aggregate_usage_categories() –≤–µ—Ä–Ω—É–ª–∞ –¥–∞–Ω–Ω—ã–µ
  3. –§—É–Ω–∫—Ü–∏—è distribute_categories_by_quarter() —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å
INFO: –ö–≤–∞—Ä—Ç–∞–ª—ã —Å by_usage (–±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã): [...]
```

---

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ by_usage –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ readiness_validator.py

**–ú–µ—Å—Ç–æ:** –§—É–Ω–∫—Ü–∏—è `_get_aggregated_data_for_enterprise()` (—Å—Ç—Ä–æ–∫–∏ 317-329)

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –ü—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ —Ç–µ–ø–µ—Ä—å **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `by_usage`**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è `by_usage` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤

**–õ–æ–≥–∏:**
```
DEBUG: ‚úÖ [DIAG] –°–æ—Ö—Ä–∞–Ω–µ–Ω by_usage –¥–ª—è electricity 2022-Q1: ['technological', 'household', ...]
DEBUG: ‚úÖ [DIAG] –î–æ–±–∞–≤–ª–µ–Ω –∫–≤–∞—Ä—Ç–∞–ª electricity 2022-Q1 —Å by_usage: [...]
DEBUG: ‚ö†Ô∏è [DIAG] –î–æ–±–∞–≤–ª–µ–Ω –∫–≤–∞—Ä—Ç–∞–ª electricity 2022-Q1 –ë–ï–ó by_usage
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ by_usage –ø–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤

**–ú–µ—Å—Ç–æ:** –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `_compute_quarter_totals()` (—Å—Ç—Ä–æ–∫–∏ 360-366)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `by_usage` –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ `by_usage` –ø–æ—Ç–µ—Ä—è–ª—Å—è –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏

**–õ–æ–≥–∏:**
```
DEBUG: ‚úÖ electricity 2022-Q1: by_usage —Å–æ—Ö—Ä–∞–Ω–µ–Ω - ['technological', 'household', ...]
WARNING: ‚ö†Ô∏è electricity 2022-Q1: by_usage –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ø–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤!
WARNING: –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –ª–∏—Å—Ç–∞ '04_–ë–∞–ª–∞–Ω—Å'
```

---

## üîç –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π "–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ '04_–ë–∞–ª–∞–Ω—Å'"
2. **–ù–∞–π–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - `"–ü–µ—Ä–µ–¥ fill_balans_sheet(): –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ —Å by_usage: X, –±–µ–∑: Y"`
   - –ï—Å–ª–∏ `Y > 0` - –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
   - –ö–∞–∫–∏–µ –∫–≤–∞—Ä—Ç–∞–ª—ã –Ω–µ –∏–º–µ—é—Ç `by_usage`
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ:

1. **–í–∫–ª—é—á–∏—Ç–µ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```python
   LOG_LEVEL=DEBUG
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
   - `[DIAG] –°–æ—Ö—Ä–∞–Ω–µ–Ω by_usage –¥–ª—è...`
   - `[DIAG] –î–æ–±–∞–≤–ª–µ–Ω –∫–≤–∞—Ä—Ç–∞–ª ... —Å by_usage`
   - `[DIAG] –î–æ–±–∞–≤–ª–µ–Ω –∫–≤–∞—Ä—Ç–∞–ª ... –ë–ï–ó by_usage`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤:**
   - `by_usage —Å–æ—Ö—Ä–∞–Ω–µ–Ω` –∏–ª–∏ `by_usage –û–¢–°–£–¢–°–¢–í–£–ï–¢`

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –£—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

```
INFO: –ü–µ—Ä–µ–¥ fill_balans_sheet(): –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ —Å by_usage: 12, –±–µ–∑: 0
INFO: –ö–≤–∞—Ä—Ç–∞–ª—ã —Å by_usage (–±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã): ['2022-Q1', '2022-Q2', ...]
INFO: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ '04_–ë–∞–ª–∞–Ω—Å'
INFO: –õ–∏—Å—Ç '04_–ë–∞–ª–∞–Ω—Å' –∑–∞–ø–æ–ª–Ω–µ–Ω
```

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

```
WARNING: –ü–µ—Ä–µ–¥ fill_balans_sheet(): –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ —Å by_usage: 0, –±–µ–∑: 12
WARNING: –ö–≤–∞—Ä—Ç–∞–ª—ã –±–µ–∑ by_usage (–±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã –≤ –ª–∏—Å—Ç–µ –±–∞–ª–∞–Ω—Å–∞): ['2022-Q1', '2022-Q2', ...]
WARNING: –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:
  1. –§–∞–π–ª pererashod.xlsx –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
  2. –§—É–Ω–∫—Ü–∏—è aggregate_usage_categories() –≤–µ—Ä–Ω—É–ª–∞ –¥–∞–Ω–Ω—ã–µ
  3. –§—É–Ω–∫—Ü–∏—è distribute_categories_by_quarter() —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å
```

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –§–ê–ô–õ–´

- `main.py` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ fill_balans_sheet()
- `utils/readiness_validator.py` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ by_usage –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏
- `utils/energy_aggregator.py` - —Ñ—É–Ω–∫—Ü–∏–∏ aggregate_usage_categories() –∏ distribute_categories_by_quarter()
- `domain/passport_requirements.py` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è by_usage

---

## –ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

