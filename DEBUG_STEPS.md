# üîç –®–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏–∑ –ë–î –≤ `main.py`
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `energy_aggregator.py`
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `readiness_validator.py`
4. ‚úÖ –£–ª—É—á—à–µ–Ω —Ä–∞—Å—á–µ—Ç –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º–µ—Å—è—á–Ω—ã—Ö

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å —Å DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```powershell
cd C:\eaip\eaip_full_skeleton\services\ingest
.\restart_debug.bat
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:8001/api/enterprises/{enterprise_id}/generation-readiness
```

–ì–¥–µ `{enterprise_id}` - ID –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è METIN IRODA.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞

–í –∫–æ–Ω—Å–æ–ª–∏, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–∏—Å, –∏—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å `[DIAG]`:

**–û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üîç [DIAG] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: pererashod.xlsx (batch_id: ...)
üìä [DIAG] raw_json –Ω–∞–π–¥–µ–Ω, –∫–ª—é—á–∏: [...]
‚úÖ [DIAG] –ê–≥—Ä–µ–≥–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ –¥–ª—è pererashod.xlsx: —Ä–µ—Å—É—Ä—Å—ã=['electricity', ...]
üîç [DIAG] –ù–∞–π–¥–µ–Ω –ª–∏—Å—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ '–≠–õ–ï–ö–¢–†': 15 —Å—Ç—Ä–æ–∫
üìä [DIAG] –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: 12, –¥–æ–±–∞–≤–ª–µ–Ω–æ –º–µ—Å—è—Ü–µ–≤: 12
üìù [DIAG] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Å—è—Ü –Ø–Ω–≤–∞—Ä—å (2022) –≤ –∫–≤–∞—Ä—Ç–∞–ª 2022-Q1: ...
üîç [DIAG] –ü–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤ –≤ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–µ
‚úÖ [DIAG] –†–∞—Å—Å—á–∏—Ç–∞–Ω—ã –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏ –¥–ª—è electricity 2022-Q1 –∏–∑ 3 –º–µ—Å—è—Ü–µ–≤: ...
```

### 4. –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç –∏–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:

**–ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ—Ç raw_json"**
- –§–∞–π–ª –Ω–µ –±—ã–ª —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∑–∞–Ω–æ–≤–æ

**–ü—Ä–æ–±–ª–µ–º–∞: "–ê–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ raw_json
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –ª–∏—Å—Ç "–≠–õ–ï–ö–¢–†" –≤ sheets

**–ü—Ä–æ–±–ª–µ–º–∞: "–ú–µ—Å—è—Ü –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–µ–≤ –≤ —Ñ–∞–π–ª–µ
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–ª–∏–∞—Å—ã –≤ MONTH_ALIASES

**–ü—Ä–æ–±–ª–µ–º–∞: "quarter_totals –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"**
- –ú–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–ª–æ–Ω–æ–∫

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```python
import sqlite3
import json

conn = sqlite3.connect('eaip_full_skeleton/services/ingest/ingest_data.db')
cursor = conn.execute("""
    SELECT batch_id, filename, raw_json 
    FROM uploads 
    WHERE filename LIKE '%pererashod%' OR filename LIKE '%electricity%'
    ORDER BY created_at DESC 
    LIMIT 1
""")
row = cursor.fetchone()
if row:
    raw_json = json.loads(row[2])
    print("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ raw_json:")
    print(f"  –ö–ª—é—á–∏: {list(raw_json.keys())}")
    if 'parsing' in raw_json:
        parsing = raw_json['parsing']
        print(f"  parsing.keys: {list(parsing.keys())}")
        if 'data' in parsing:
            data = parsing['data']
            print(f"  data.keys: {list(data.keys())}")
            if 'sheets' in data:
                sheets = data['sheets']
                print(f"  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤: {len(sheets)}")
                for sheet in sheets:
                    print(f"    - {sheet.get('name')}: {len(sheet.get('rows', []))} —Å—Ç—Ä–æ–∫")
```

## üìã –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö:

1. **–ù–∞–π–¥–µ–Ω –ª–∏ –ª–∏—Å—Ç "–≠–õ–ï–ö–¢–†"?**
   - –ò—â–∏—Ç–µ: `üîç [DIAG] –ù–∞–π–¥–µ–Ω –ª–∏—Å—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏`

2. **–ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ª–∏ –º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?**
   - –ò—â–∏—Ç–µ: `üìù [DIAG] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Å—è—Ü ...`

3. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ª–∏ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏?**
   - –ò—â–∏—Ç–µ: `‚úÖ [DIAG] –†–∞—Å—Å—á–∏—Ç–∞–Ω—ã –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏`

4. **–ï—Å—Ç—å –ª–∏ quarter_totals –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞?**
   - –ò—â–∏—Ç–µ: `quarter_totals=['active_kwh', ...]`

## üéØ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è:

–ü—Ä–∏—à–ª–∏—Ç–µ:
1. –õ–æ–≥–∏ —Å `[DIAG]` –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–∏—Å–∞
2. –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
3. –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–µ–π, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏

