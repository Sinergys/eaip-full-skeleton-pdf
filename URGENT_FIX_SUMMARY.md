# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏–∑ –ë–î
**–§–∞–π–ª:** `main.py:1029-1042`

–ï—Å–ª–∏ `aggregate_energy_data(dst)` –Ω–µ —É–¥–∞–ª–∞—Å—å, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—É–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `aggregate_from_db_json`.

### 2. –£–ª—É—á—à–µ–Ω —Ä–∞—Å—á–µ—Ç –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `energy_aggregator.py:_compute_quarter_totals()`

- –ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ **–í–°–ï–ì–î–ê** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏–∑ –º–µ—Å—è—á–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ None –∑–Ω–∞—á–µ–Ω–∏–π

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–§–∞–π–ª—ã:** `energy_aggregator.py`, `main.py`

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[DIAG]` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö:

1. **–§–∞–π–ª –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –∫–∞–∫ —Ñ–∞–π–ª –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `should_aggregate_file(safe_filename)`
   - –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Excel (.xlsx, .xlsm, .xls)

2. **–ú–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å `[DIAG]`
   - –ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è "–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Å—è—Ü ..."

3. **–ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ "–†–∞—Å—Å—á–∏—Ç–∞–Ω—ã –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏"
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

4. **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `AGGREGATED_DIR`
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã `{batch_id}_aggregated.json`

## üõ†Ô∏è –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å —Å DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:**
   ```powershell
   cd C:\eaip\eaip_full_skeleton\services\ingest
   .\restart_debug.bat
   ```

2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–µ–π –∑–∞–Ω–æ–≤–æ**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è `[DIAG]`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
   ```powershell
   ls data\inbox\aggregated\*aggregated.json
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8001/api/enterprises/{id}/generation-readiness
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 100% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:

```
üìù [DIAG] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Å—è—Ü –Ø–Ω–≤–∞—Ä—å (2022) –≤ –∫–≤–∞—Ä—Ç–∞–ª 2022-Q1: –ø–æ–ª—è=['active_kwh', ...]
üîç [DIAG] –ü–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤. –†–µ—Å—É—Ä—Å—ã: ['electricity', ...]
üìä [DIAG] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–∞ 'electricity': 4 –∫–≤–∞—Ä—Ç–∞–ª–æ–≤
‚úÖ [DIAG] –†–∞—Å—Å—á–∏—Ç–∞–Ω—ã –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏ –¥–ª—è electricity 2022-Q1 –∏–∑ 3 –º–µ—Å—è—Ü–µ–≤: ...
```

–ï—Å–ª–∏ —ç—Ç–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –º–µ—Å—è—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞.

