# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ PDF –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è OCR

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω

```bash
cd infra
docker compose up -d ingest
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
```bash
docker compose ps ingest
```

–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:
```bash
curl http://localhost:8001/health
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:8001/web/upload**

1. –í—ã–±–µ—Ä–∏—Ç–µ PDF —Ñ–∞–π–ª (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç)
2. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ü–∏—é "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è"
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "üîç OCR: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ"

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install requests

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º —Ñ–∞–π–ª–æ–º
python test_pdf_ocr.py infra/passport_demo1.pdf

# –ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π —Ñ–∞–π–ª
python test_pdf_ocr.py –ø—É—Ç—å/–∫/–≤–∞—à–µ–º—É/—Ñ–∞–π–ª—É.pdf
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API –Ω–∞–ø—Ä—è–º—É—é

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
curl -X POST http://localhost:8001/web/upload \
  -F "file=@infra/passport_demo1.pdf"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–∑–∞–º–µ–Ω–∏—Ç–µ BATCH_ID)
curl http://localhost:8001/ingest/parse/BATCH_ID

# –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞
curl http://localhost:8001/ingest/parse/BATCH_ID/summary
```

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

### ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (.pdf)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME-—Ç–∏–ø–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–¥–æ 50 –ú–ë)

### ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ PDF
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ pdfplumber/PyPDF2
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ü–æ–¥—Å—á–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Å–∏–º–≤–æ–ª–æ–≤

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∫–∞–Ω–∞
- –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç–∞ < 50 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è OCR
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

### ‚úÖ OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (300 DPI)
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Tesseract (—Ä—É—Å—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- –ò–Ω–¥–∏–∫–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OCR –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ PDF:

1. **–§–∞–π–ª –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω** ‚úÖ
2. **–ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—á–∞—Ç** ‚úÖ
3. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –º–∞–ª–æ —Ç–µ–∫—Å—Ç–∞** ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è OCR ‚úÖ
4. **OCR –∑–∞–≤–µ—Ä—à–µ–Ω** ‚Üí —Ç–µ–∫—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω ‚úÖ
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** —Å —Ñ–ª–∞–≥–æ–º `ocr_used: true` ‚úÖ

–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Å–∏–º–≤–æ–ª—ã)
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ü–∏—è "üîç OCR: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ"
- ‚úÖ –ü—Ä–µ–≤—å—é –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå OCR –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ PDF (–Ω–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç)

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PDF –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### ‚ùå –û—à–∏–±–∫–∞ "Tesseract –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** Tesseract –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:** 
```bash
docker compose build ingest
docker compose up -d ingest
```

### ‚ùå –û—à–∏–±–∫–∞ "pdf2image –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"

**–ü—Ä–∏—á–∏–Ω–∞:** Poppler utils –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã `poppler-utils`

### ‚ùå –°–µ—Ä–≤–∏—Å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose restart ingest

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs ingest
```

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker compose logs -f ingest
```

–û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ OCR:
```
INFO: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –º–∞–ª–æ —Ç–µ–∫—Å—Ç–∞ (X —Å–∏–º–≤–æ–ª–æ–≤/—Å—Ç—Ä–∞–Ω–∏—Ü—É), –ø—Ä–∏–º–µ–Ω—è—é OCR...
INFO: –ù–∞—á–∏–Ω–∞—é OCR –æ–±—Ä–∞–±–æ—Ç–∫—É PDF: /data/inbox/...
INFO: PDF –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ N –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
INFO: OCR —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –∏–∑–≤–ª–µ—á–µ–Ω–æ X —Å–∏–º–≤–æ–ª–æ–≤
INFO: OCR –∑–∞–≤–µ—Ä—à–µ–Ω: –≤—Å–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ X —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ N —Å—Ç—Ä–∞–Ω–∏—Ü
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ PDF —Ñ–∞–π–ª—ã:
- `infra/passport_demo1.pdf`
- `infra/passport_demo1_full.pdf`
- `infra/data/inbox/*.pdf`

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –∏–∑ –Ω–∏—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

